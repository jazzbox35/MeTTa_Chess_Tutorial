(= (nth $_321716 $_321722) (if (== $_321716 1) (car-atom $_321722) (nth (- $_321716 1) (cdr-atom $_321722))))
(= (contains_symbol $_321548 $_321554) (if (== $_321548 ()) false (if (== (car-atom $_321548) $_321554) true (contains_symbol (cdr-atom $_321548) $_321554))))
(= (char_to_int $_321188) (case $_321188 ((1 1) (2 2) (3 3) (4 4) (5 5) (6 6) (7 7) (8 8) (a 1) (b 2) (c 3) (d 4) (e 5) (f 6) (g 7) (h 8) ($_321512 NIL))))
(= (int_to_char $_320972) (case $_320972 ((1 a) (2 b) (3 c) (4 d) (5 e) (6 f) (7 g) (8 h) ($_321152 ?))))
(= (return_length $_320888) (let $_320906 (stringToChars $_320888) (size-atom $_320906)))
(= (convert_x_letter $_320486) (let* (($_320516 (nth 1 $_320486)) ($_320552 (int_to_char $_320516)) ($_320582 (nth 2 $_320486))) (if (== (size-atom $_320486) 2) ($_320552 $_320582) (let* (($_320702 (nth 3 $_320486)) ($_320738 (nth 4 $_320486))) (if (== $_320702 s) ($_320552 $_320582 white $_320738) ($_320552 $_320582 black $_320738))))))
(= (concat_lists $_320102) (if (== $_320102 ()) () (let $_320162 (car-atom $_320102) (if (== $_320162 ()) (concat_lists (cdr-atom $_320102)) (let* (($_320276 (car-atom $_320162)) ($_320306 (cdr-atom $_320162)) ($_320336 (cdr-atom $_320102))) (let $_320372 (cons-atom $_320306 $_320336) (let $_320414 (concat_lists $_320372) (cons-atom $_320276 $_320414))))))))
(= (addit_list $_319970) (if (== $_319970 ()) 0 (+ (car-atom $_319970) (addit_list (cdr-atom $_319970)))))
(: (progq) (-> Expression Atom))
(= (progq $_319772) (if (== $_319772 ()) () (let $_319832 (unquote (car-atom $_319772)) (progq (cdr-atom $_319772)))))
(g k k)
(g q q)
(g r r)
(g b b)
(g n n)
(g p p)
(s k k)
(s q q)
(s r r)
(s b b)
(s n n)
(s p p)
(= (add-pieces $_319262) (if (== $_319262 ()) true (let* (($_319334 (car-atom $_319262)) ($_319364 (cons-atom square $_319334)) ($_319400 (add-atom &self $_319364))) (add-pieces (cdr-atom $_319262)))))
(= (reset-pieces $_319106) (progn (remove-atom &self (square $_319154 $_319160 $_319166 $_319172)) (remove-atom &self (square $_319154 $_319160)) (add-pieces $_319106)))
(= (delete-pieces) (progn (remove-atom &self (square $_319016 $_319022 $_319028 $_319034)) (remove-atom &self (square $_319016 $_319022))))
(= (delete-temporary-atoms) (match &self (score $_318824 $_318830 $_318836 $_318842 $_318848 $_318854 $_318860 $_318866) (remove-atom &self (score $_318824 $_318830 $_318836 $_318842 $_318848 $_318854 $_318860 $_318866))))
(= (delete-prior-game-states) (collapse (match &self (game-state $_318728) (remove-atom &self (game-state $_318728)))))
(= (change-game-state $_318596) (progn (delete-prior-game-states) (add-atom &self (game-state $_318596))))
(= (lots_of_pawns_in_home_row) (let $_318404 (collapse (match &self (square $_318452 7 g p) (square $_318452 $_318494 $_318500 $_318506))) (if (> (size-atom $_318404) 6) true false)))
(= (display_squares_atoms_debug_4) (collapse (match &self (square $_318308 $_318314 $_318320 $_318326) (square $_318308 $_318314 $_318320 $_318326))))
(= (display_squares_atoms_debug_2) (collapse (match &self (square $_318206 $_318212) (square $_318206 $_318212))))
(= (display_scores_debug) (collapse (match &self (score $_318032 $_318038 $_318044 $_318050 $_318056 $_318062 $_318068 $_318074) (score $_318032 $_318038 $_318044 $_318050 $_318056 $_318062 $_318068 $_318074))))
(= (display-game-state) (match &self (game-state $_317942) (println $_317942)))
(= (get-player-command $_317672) (let $_317690 (get-single-char!) (progn (if (== (size-atom $_317672) 0) (flush-output!) ()) (if (== $_317690 13) $_317672 (let $_317840 (cons-atom $_317690 $_317672) (get-player-command $_317840))))))
(= (welcome) (welcome!))
(: (identify_piece) (-> Expression Atom))
(= (identify_piece $_317348) (if (== (size-atom $_317348) 2) . (let* (($_317432 (nth 3 $_317348)) ($_317468 (nth 4 $_317348)) ($_317504 (match &self ($_317432 $_317468 $_317546) $_317546))) $_317504)))
(: (identify_piece_text) (-> Expression Atom))
(= (identify_piece_text $_317042) (if (== (size-atom $_317042) 2) (let* (($_317120 (contains_symbol $_317042 s)) ($_317156 (if (== $_317120 true) *)) ($_317210 (nth 4 $_317042))) (format-args {}{} ($_317156 $_317210)))))
(: (display_filter) (-> Expression Expression))
(= (display_filter $_316730) (if (== (size-atom $_316730) 1) (let $_316796 (identify_piece (car-atom $_316730)) ($_316796)) (let* (($_316868 (display_filter (cdr-atom $_316730))) ($_316910 (identify_piece (car-atom $_316730)))) (cons-atom $_316910 $_316868))))
(= (display_board $_316682) (println OK))
(= (display_board_text $_316640) ($_316640))
(= (game-still-playing) (match &self (game-state $_316526) (if (or (== checkmate $_316526) (== resigned $_316526)) false true)))
(= (prompt-for-move) (OK))
(= (decide_greedy_move) (let* (($_315320 (println looking for checkmate...)) ($_315362 (collapse (if (== (lots_of_pawns_in_home_row) true) (empty) (attemptcheckmate))))) (if (not (== $_315362 ())) (car-atom $_315362) (let* (($_315536 (println looking for capture...)) ($_315578 (collapse (takehighestopen_scored)))) (if (not (== $_315578 ())) (car-atom $_315578) (let* (($_315698 (println looking to play defense...)) ($_315746 (collapse (playdefense)))) (if (not (== $_315746 ())) (car-atom $_315746) (let* (($_315866 (println looking for threat position...)) ($_315914 (random-int &rng 1 2)) ($_315956 (if (> $_315914 1) (collapse (movetoposition)) ()))) (if (not (== $_315956 ())) (car-atom $_315956) (let* (($_316118 (println looking for random move...)) ($_316166 (collapse (random_move_empty_sq)))) (if (not (== $_316166 ())) (car-atom $_316166) (let* (($_316286 (println looking for desperation move...)) ($_316334 (collapse (random_move_empty_sq_desperate)))) (if (not (== $_316334 ())) (car-atom $_316334) ())))))))))))))
(= (try_move_and_verify ($_314480 $_314486 g $_314498) ($_314510 $_314516) $_314522) (let* (($_314552 ($_314480 $_314486 g $_314498)) ($_314594 ($_314510 $_314516)) ($_314624 (return_entire_box $_314594)) ($_314654 (move_piece $_314552 $_314594)) ($_314690 (take_dest ($_314510 $_314516) s))) (if (== $_314690 true) (let $_314654 (reset_pieces $_314552 $_314624) (empty)) (let* (($_314846 (xy_box (g k))) ($_314888 (return_entire_box $_314846)) ($_314918 (take_dest $_314888 s))) (if (== $_314918 true) (let $_314654 (reset_pieces $_314552 $_314624) (empty)) (let* (($_315062 (case $_314522 ((1 (score_move ($_314480 $_314486 g $_314498) ($_314510 $_314516))) (0 0)))) ($_314654 (reset_pieces $_314552 $_314624))) (($_314480 $_314486 g $_314498) ($_314510 $_314516))))))))
(= (find_by_rank_move_empty_sq $_314168) (match &self (, ($_314168 $_314216) (square $_314234 $_314240 g $_314216) (square $_314270 $_314276)) (if (== (clear_route ($_314234 $_314240 g $_314216) ($_314270 $_314276)) true) (try_move_and_verify ($_314234 $_314240 g $_314216) ($_314270 $_314276) 0) (empty))))
(= (return_random_level $_313628) (if (== (size-atom $_313628) 4) NIL (let* (($_313712 (if (and (== (lots_of_pawns_in_home_row) true) (not (== (intersection-atom $_313628 (lowrank)) (lowrank)))) 1 (random-int &rng 1 7))) ($_313880 (case $_313712 ((1 lowrank) (2 medrank) (3 highrank) (4 lowrank) (5 medrank) (6 highrank) (7 highestrank) ($_314042 lowrank))))) (if (== ($_313880) (intersection-atom $_313628 ($_313880))) (return_random_level $_313628) $_313880))))
(= (random_recursion_by_rank $_313376) (let* (($_313406 (return_random_level $_313376))) (if (== $_313406 NIL) (empty) (let $_313490 (collapse (find_by_rank_move_empty_sq $_313406)) (if (== $_313490 ()) (random_recursion_by_rank (cons-atom $_313406 $_313376)) $_313490)))))
(= (random_move_empty_sq) (let $_313022 (collapse (random_recursion_by_rank ())) (if (== $_313022 ()) (empty) (let* (($_313130 (car-atom $_313022)) ($_313160 (size-atom $_313130)) ($_313190 (if (== $_313160 2) 1 (random-int &rng 1 $_313160))) ($_313274 (if (> $_313190 $_313160) 1 $_313190))) (nth $_313274 $_313130)))))
(= (random_move_empty_sq_desperate) (let $_312872 (collapse (any_moves_to_escape g)) (if (not (== $_312872 ())) (car-atom $_312872) (empty))))
(= (attemptcheckmate) (let $_312290 (collapse (attemptcheckmate_match)) (let $_312332 (collapse (let $_312362 (superpose $_312290) (let* (($_312410 (nth 1 $_312362)) ($_312446 (nth 2 $_312362)) ($_312482 (return_entire_box $_312446)) ($_312512 (move_piece $_312410 $_312446)) ($_312548 (collapse (any_moves_to_escape s))) ($_312590 (checkking g)) ($_312620 (reset_pieces $_312410 $_312482))) (if (and (== $_312548 ()) (== $_312590 false)) $_312362 (empty))))) (if (== $_312332 ()) (empty) (progn (change-game-state checkmate) (car-atom $_312332))))))
(= (attemptcheckmate_match) (let $_311888 (xy_box (s k)) (match &self (square $_311954 $_311960 g $_311972) (match &self (square $_312008 $_312014) (if (and (== (clear_route ($_311954 $_311960 g $_311972) ($_312008 $_312014)) true) (== (clear_route ($_312008 $_312014 g $_311972) $_311888) true)) (($_311954 $_311960 g $_311972) ($_312008 $_312014)) (empty))))))
(= (attemptcheckmate_match) (let $_311474 (xy_box (s k)) (match &self (square $_311540 $_311546 g $_311558) (match &self (square $_311594 $_311600 s $_311612) (if (and (== (clear_route ($_311540 $_311546 g $_311558) ($_311594 $_311600)) true) (== (clear_route ($_311594 $_311600 g $_311558) $_311474) true)) (($_311540 $_311546 g $_311558) ($_311594 $_311600)) (empty))))))
(= (movetoposition) (let $_311138 (collapse (movetoposition_match (superpose (q r n b)) (superpose (k q r n b)))) (if (== $_311138 ()) (empty) (let* (($_311330 (size-atom $_311138)) ($_311360 (random-int &rng 1 $_311330)) ($_311402 (nth $_311360 $_311138))) $_311402))))
(= (movetoposition_match $_310358 $_310364) (match &self (square $_310400 $_310406 g $_310358) (match &self (square $_310454 $_310460) (if (== (clear_route ($_310400 $_310406 g $_310358) ($_310454 $_310460)) true) (match &self (square $_310586 $_310592 s $_310364) (if (== (clear_route ($_310454 $_310460 g $_310358) ($_310586 $_310592)) true) (let* (($_310724 (move_piece ($_310400 $_310406 g $_310358) ($_310454 $_310460))) ($_310796 (take_dest ($_310454 $_310460) s)) ($_310844 (checkking g)) ($_310874 (reset_pieces ($_310400 $_310406 g $_310358) ($_310454 $_310460)))) (if (and (== $_310796 false) (== $_310844 false)) (($_310400 $_310406 g $_310358) ($_310454 $_310460)) (empty))) (empty))) (empty)))))
(= (playdefense) (let $_310076 (collapse (playdefense_match (superpose (k q r n b)))) (if (== $_310076 ()) (empty) (let* (($_310226 (size-atom $_310076)) ($_310256 (random-int &rng 1 $_310226)) ($_310298 (nth $_310256 $_310076))) $_310298))))
(= (playdefense_match $_309200) (match &self (square $_309236 $_309242 g $_309200) (if (== (take_dest ($_309236 $_309242) s) true) (if (or (== (take_dest ($_309236 $_309242) g) false) (and (== (take_dest ($_309236 $_309242) g) true) (== $_309200 q))) (match &self (square $_309524 $_309530) (if (== (clear_route ($_309236 $_309242 g $_309200) ($_309524 $_309530)) true) (let* (($_309650 (move_piece ($_309236 $_309242 g $_309200) ($_309524 $_309530))) ($_309722 (take_dest ($_309524 $_309530) s)) ($_309770 (checkking g)) ($_309800 (reset_pieces ($_309236 $_309242 g $_309200) ($_309524 $_309530)))) (if (and (== $_309722 false) (== $_309770 false)) (($_309236 $_309242 g $_309200) ($_309524 $_309530)) (empty))) (empty))) (empty)) (empty))))
(= (playdefense_match $_308438) (match &self (square $_308474 $_308480 g $_308438) (match &self (square $_308528 $_308534 s p) (if (== (clear_route ($_308528 $_308534 s p) ($_308474 $_308480)) true) (match &self (square $_308672 $_308678) (if (== (clear_route ($_308474 $_308480 g $_308438) ($_308672 $_308678)) true) (let* (($_308798 (move_piece ($_308474 $_308480 g $_308438) ($_308672 $_308678))) ($_308870 (take_dest ($_308672 $_308678) s)) ($_308918 (checkking g)) ($_308948 (reset_pieces ($_308474 $_308480 g $_308438) ($_308672 $_308678)))) (if (and (== $_308870 false) (== $_308918 false)) (($_308474 $_308480 g $_308438) ($_308672 $_308678)) (empty))) (empty))) (empty)))))
(= (takehighestopen_scored) (let $_308114 (collapse (takehighestopen (superpose (b r n q p)))) (if (not (== $_308114 ())) (let* (($_308264 (collapse (finalize_all_scored_moves))) ($_308300 (find_best_score $_308264)) ($_308330 (cdr-atom $_308300))) (let $_308366 (collapse (delete-temporary-atoms)) $_308330)) (empty))))
(= (finalize_all_scored_moves) (match &self (score $_307928 $_307934 $_307940 $_307946 $_307952 $_307958 $_307964 $_307970) (let $_307988 (+ $_307964 $_307970) ($_307988 ($_307928 $_307934 $_307940 $_307946) ($_307952 $_307958)))))
(= (find_best_score $_307442) (if (== (size-atom $_307442) 1) (car-atom $_307442) (let* (($_307538 (car-atom $_307442)) ($_307568 (car-atom $_307538)) ($_307598 (cdr-atom $_307442)) ($_307628 (car-atom $_307598)) ($_307658 (car-atom $_307628))) (if (or (< $_307568 $_307658) (== $_307568 $_307658)) (let* (($_307778 (cdr-atom $_307598)) ($_307808 (cons-atom $_307538 $_307778))) (find_best_score $_307808)) (find_best_score $_307598)))))
(= (takehighestopen $_307064) (match &self (square $_307100 $_307106 s $_307064) (match &self (square $_307154 $_307160 g p) (if (and (== $_307106 (- $_307160 1)) (or (== $_307100 (- $_307154 1)) (== $_307100 (+ $_307154 1)))) (try_move_and_verify ($_307154 $_307160 g p) ($_307100 $_307106) 1) (empty)))))
(= (takehighestopen $_306710) (match &self (square $_306746 $_306752 s $_306710) (match &self (square $_306800 $_306806 g $_306818) (if (and (== (clear_route ($_306800 $_306806 g $_306818) ($_306746 $_306752)) true) (not (== $_306818 p))) (try_move_and_verify ($_306800 $_306806 g $_306818) ($_306746 $_306752) 1) (empty)))))
(= (take_dest_recursive $_306512 $_306518 $_306524) (let* (($_306554 (takingboxes_recursive $_306518 $_306524)) ($_306590 (list_clear_route $_306524 $_306512 $_306554))) (if (not (== $_306590 ())) true false)))
(= (take_dest $_306320 $_306326) (let* (($_306356 (collapse (takingboxes $_306326))) ($_306398 (collapse (list_clear_route $_306320 $_306356)))) (if (== $_306398 ()) false true)))
(= (return_entire_box ($_306224 $_306230)) (match &self (square $_306224 $_306230) ($_306224 $_306230)))
(= (return_entire_box ($_306098 $_306104)) (match &self (square $_306098 $_306104 $_306152 $_306158) ($_306098 $_306104 $_306152 $_306158)))
(= (return_entire_box ($_306014 $_306020 $_306026 $_306032)) ($_306014 $_306020 $_306026 $_306032))
(= (return_entire_box_sequential $_305708 $_305714) (if (== (size-atom $_305708) 4) $_305708 (let* (($_305798 (car-atom $_305714)) ($_305828 (nth 1 $_305798)) ($_305864 (nth 2 $_305798))) (if (== ($_305828 $_305864) $_305708) $_305798 (return_entire_box_sequential $_305708 (cdr-atom $_305714))))))
(= (xy_box ($_305600 $_305606)) (match &self (square $_305642 $_305648 $_305600 $_305606) ($_305642 $_305648)))
(= (xy_box_recursive ($_305108 $_305114) $_305120) (let* (($_305150 (car-atom $_305120)) ($_305180 (nth 1 $_305150)) ($_305216 (nth 2 $_305150))) (if (== (size-atom $_305150) 2) (xy_box_recursive ($_305108 $_305114) (cdr-atom $_305120)) (let* (($_305366 (nth 3 $_305150)) ($_305402 (nth 4 $_305150))) (if (and (== $_305366 $_305108) (== $_305402 $_305114)) ($_305180 $_305216) (xy_box_recursive ($_305108 $_305114) (cdr-atom $_305120)))))))
(= (clear_route ($_304658 $_304664 $_304670 k) $_304682) (let* (($_304712 (nth 1 $_304682)) ($_304748 (nth 2 $_304682))) (if (and (or (== $_304712 $_304658) (or (== $_304712 (- $_304658 1)) (== $_304712 (+ $_304658 1)))) (or (== $_304748 $_304664) (or (== $_304748 (- $_304664 1)) (== $_304748 (+ $_304664 1))))) true false)))
(= (clear_route ($_304466 $_304472 $_304478 q) $_304490) (if (or (clear_route ($_304466 $_304472 $_304478 b) $_304490) (clear_route ($_304466 $_304472 $_304478 r) $_304490)) true false))
(= (clear_route ($_303872 $_303878 $_303884 n) $_303896) (let* (($_303926 (nth 1 $_303896)) ($_303962 (nth 2 $_303896))) (if (or (and (or (== $_303926 (- $_303872 1)) (== $_303926 (+ $_303872 1))) (or (== $_303962 (- $_303878 2)) (== $_303962 (+ $_303878 2)))) (and (or (== $_303926 (- $_303872 2)) (== $_303926 (+ $_303872 2))) (or (== $_303962 (- $_303878 1)) (== $_303962 (+ $_303878 1))))) true false)))
(= (clear_route ($_302966 $_302972 g p) $_302990) (let* (($_303020 (nth 1 $_302990)) ($_303056 (nth 2 $_302990)) ($_303092 (return_entire_box $_302990)) ($_303122 ($_303020 6)) ($_303152 (return_entire_box $_303122))) (if (or (and (== $_302966 $_303020) (and (== $_303056 (- $_302972 1)) (== (size-atom $_303092) 2))) (or (and (== $_302966 $_303020) (and (== $_302972 7) (and (== $_303056 5) (and (== (size-atom $_303092) 2) (== (size-atom $_303152) 2))))) (or (and (== $_303020 (+ $_302966 1)) (and (== $_303056 (- $_302972 1)) (== (size-atom $_303092) 4))) (and (== $_303020 (- $_302966 1)) (and (== $_303056 (- $_302972 1)) (== (size-atom $_303092) 4)))))) true false)))
(= (clear_route ($_302060 $_302066 s p) $_302084) (let* (($_302114 (nth 1 $_302084)) ($_302150 (nth 2 $_302084)) ($_302186 (return_entire_box $_302084)) ($_302216 ($_302060 3)) ($_302246 (return_entire_box $_302216))) (if (or (or (and (== $_302114 (+ $_302060 1)) (and (== $_302150 (+ $_302066 1)) (== (size-atom $_302186) 4))) (and (== $_302114 (- $_302060 1)) (and (== $_302150 (+ $_302066 1)) (== (size-atom $_302186) 4)))) (or (and (== $_302060 $_302114) (and (== $_302150 (+ $_302066 1)) (== (size-atom $_302186) 2))) (and (== $_302060 $_302114) (and (== $_302066 2) (and (== $_302150 4) (and (== (size-atom $_302186) 2) (== (size-atom $_302246) 2))))))) true false)))
(= (clear_route ($_301406 $_301412 $_301418 r) $_301430) (let* (($_301460 (nth 1 $_301430)) ($_301496 (nth 2 $_301430)) ($_301532 (if (and (== $_301460 $_301406) (> $_301496 $_301412)) (clearcheckup $_301406 (+ 1 $_301412) $_301496) (if (and (== $_301460 $_301406) (< $_301496 $_301412)) (clearcheckdown $_301406 (- $_301412 1) $_301496) (if (and (> $_301460 $_301406) (== $_301496 $_301412)) (clearcheckright (+ $_301406 1) $_301460 $_301412) (if (and (< $_301460 $_301406) (== $_301496 $_301412)) (clearcheckleft (- $_301406 1) $_301460 $_301412) false)))))) $_301532))
(= (clearcheckup $_301124 $_301130 $_301136) (let $_301154 (if (< $_301130 9) (return_entire_box ($_301124 $_301130)) ()) (if (== $_301130 $_301136) true (if (== (size-atom $_301154) 2) (clearcheckup $_301124 (+ $_301130 1) $_301136) false))))
(= (clearcheckdown $_300848 $_300854 $_300860) (let $_300878 (if (> $_300854 0) (return_entire_box ($_300848 $_300854)) ()) (if (== $_300854 $_300860) true (if (== (size-atom $_300878) 2) (clearcheckdown $_300848 (- $_300854 1) $_300860) false))))
(= (clearcheckright $_300572 $_300578 $_300584) (let $_300602 (if (< $_300572 9) (return_entire_box ($_300572 $_300584)) ()) (if (== $_300572 $_300578) true (if (== (size-atom $_300602) 2) (clearcheckright (+ $_300572 1) $_300578 $_300584) false))))
(= (clearcheckleft $_300296 $_300302 $_300308) (let $_300326 (if (> $_300296 0) (return_entire_box ($_300296 $_300308)) ()) (if (== $_300296 $_300302) true (if (== (size-atom $_300326) 2) (clearcheckleft (- $_300296 1) $_300302 $_300308) false))))
(= (clear_route ($_299552 $_299558 $_299564 b) $_299576) (let* (($_299606 (nth 1 $_299576)) ($_299642 (nth 2 $_299576)) ($_299678 (if (and (> $_299606 $_299552) (> $_299642 $_299558)) (clearcheckNE (+ 1 $_299552) (+ 1 $_299558) $_299606 $_299642) (if (and (> $_299606 $_299552) (< $_299642 $_299558)) (clearcheckSE (+ 1 $_299552) (- $_299558 1) $_299606 $_299642) (if (and (< $_299606 $_299552) (> $_299642 $_299558)) (clearcheckNW (- $_299552 1) (+ $_299558 1) $_299606 $_299642) (if (and (< $_299606 $_299552) (< $_299642 $_299558)) (clearcheckSW (- $_299552 1) (- $_299558 1) $_299606 $_299642) false)))))) $_299678))
(= (clearcheckNE $_299096 $_299102 $_299108 $_299114) (let $_299132 (if (and (and (< $_299096 9) (> $_299096 0)) (and (< $_299102 9) (> $_299102 0))) (return_entire_box ($_299096 $_299102)) ()) (if (and (== $_299102 $_299114) (== $_299096 $_299108)) true (if (== (size-atom $_299132) 2) (clearcheckNE (+ $_299096 1) (+ $_299102 1) $_299108 $_299114) false))))
(= (clearcheckSE $_298646 $_298652 $_298658 $_298664) (let $_298682 (if (and (and (< $_298646 9) (> $_298646 0)) (and (< $_298652 9) (> $_298652 0))) (return_entire_box ($_298646 $_298652)) ()) (if (and (== $_298652 $_298664) (== $_298646 $_298658)) true (if (== (size-atom $_298682) 2) (clearcheckSE (+ $_298646 1) (- $_298652 1) $_298658 $_298664) false))))
(= (clearcheckNW $_298196 $_298202 $_298208 $_298214) (let $_298232 (if (and (and (< $_298196 9) (> $_298196 0)) (and (< $_298202 9) (> $_298202 0))) (return_entire_box ($_298196 $_298202)) ()) (if (and (== $_298202 $_298214) (== $_298196 $_298208)) true (if (== (size-atom $_298232) 2) (clearcheckNW (- $_298196 1) (+ $_298202 1) $_298208 $_298214) false))))
(= (clearcheckSW $_297746 $_297752 $_297758 $_297764) (let $_297782 (if (and (and (< $_297746 9) (> $_297746 0)) (and (< $_297752 9) (> $_297752 0))) (return_entire_box ($_297746 $_297752)) ()) (if (and (== $_297752 $_297764) (== $_297746 $_297758)) true (if (== (size-atom $_297782) 2) (clearcheckSW (- $_297746 1) (- $_297752 1) $_297758 $_297764) false))))
(: (replace_square_recursive) (-> Atom Atom Atom Atom Atom Atom Expression Expression))
(= (replace_square_recursive $_296870 $_296876 $_296882 $_296888 $_296894 $_296900 $_296906) (if (== (size-atom $_296906) 0) () (let* (($_296990 (car-atom $_296906)) ($_297020 (nth 1 $_296990)) ($_297056 (nth 2 $_296990))) (if (and (== $_297020 $_296870) (== $_297056 $_296876)) (let $_297170 ($_296870 $_296876) (let $_297206 (replace_square_recursive $_296870 $_296876 $_296882 $_296888 $_296894 $_296900 (cdr-atom $_296906)) (cons-atom $_297170 $_297206))) (if (and (== $_297020 $_296894) (== $_297056 $_296900)) (let $_297386 ($_296894 $_296900 $_296882 $_296888) (let $_297206 (replace_square_recursive $_296870 $_296876 $_296882 $_296888 $_296894 $_296900 (cdr-atom $_296906)) (cons-atom $_297386 $_297206))) (let $_297206 (replace_square_recursive $_296870 $_296876 $_296882 $_296888 $_296894 $_296900 (cdr-atom $_296906)) (cons-atom $_296990 $_297206)))))))
(= (move_piece_on_board $_296222 $_296228 $_296234) (let* (($_296264 (nth 1 $_296222)) ($_296300 (nth 2 $_296222)) ($_296336 (nth 3 $_296222)) ($_296372 (nth 4 $_296222)) ($_296408 (nth 1 $_296228)) ($_296444 (nth 2 $_296228)) ($_296480 (replace_square_recursive $_296264 $_296300 $_296336 $_296372 $_296408 $_296444 $_296234)) ($_296546 (convert_x_letter $_296222)) ($_296576 (convert_x_letter $_296228)) ($_296606 (println ((Moving from: $_296546 to: $_296576)))) ($_296672 (if (== (size-atom $_296228) 2) () (println Piece captured!))) ($_296762 (if (== (size-atom $_296228) 2) () (println $_296576)))) $_296480))
(= (reset_square $_296132 $_296138) (remove-atom &self (square $_296132 $_296138 $_296186 $_296192)))
(= (reset_square $_296054 $_296060) (remove-atom &self (square $_296054 $_296060)))
(= (move_piece ($_295676 $_295682 $_295688 $_295694) ($_295706 $_295712)) (let* (($_295742 (square $_295676 $_295682 $_295688 $_295694)) ($_295790 (remove-atom &self $_295742)) ($_295826 (square $_295676 $_295682)) ($_295862 (add-atom &self $_295826)) ($_295898 (collapse (reset_square $_295706 $_295712))) ($_295946 (square $_295706 $_295712 $_295688 $_295694)) ($_295994 (add-atom &self $_295946))) true))
(= (reset_pieces ($_295520 $_295526 $_295532 $_295538) ($_295550 $_295556)) (let $_295574 (move_piece ($_295550 $_295556 $_295532 $_295538) ($_295520 $_295526)) true))
(= (reset_pieces ($_295220 $_295226 $_295232 $_295238) ($_295250 $_295256 $_295262 $_295268)) (let* (($_295298 (move_piece ($_295250 $_295256 $_295232 $_295238) ($_295220 $_295226))) ($_295370 (remove-atom &self (square $_295250 $_295256))) ($_295424 (add-atom &self (square $_295250 $_295256 $_295262 $_295268)))) true))
(= (get_score $_295016) (match &self (square $_295052 $_295058 $_295016 $_295070) (case $_295070 ((p 1) (n 3) (b 3) (r 5) (q 9)))))
(= (human_player_attacking) (match &self (square $_294752 $_294758 g $_294770) (let $_294788 (take_dest ($_294752 $_294758) s) (if (== $_294788 true) (case $_294770 ((p 1) (n 3) (b 3) (r 5) (q 9))) (empty)))))
(= (score_move ($_294422 $_294428 $_294434 $_294440) ($_294452 $_294458)) (let* (($_294488 (collapse (get_score s))) ($_294530 (addit_list $_294488)) ($_294560 (collapse (human_player_attacking))) ($_294596 (addit_list $_294560))) (add-atom &self (score $_294422 $_294428 $_294434 $_294440 $_294452 $_294458 $_294530 $_294596))))
(= (checkking $_294212) (let* (($_294242 (xy_box ($_294212 k))) ($_294284 (return_entire_box $_294242))) (if (== $_294212 s) (take_dest $_294284 g) (take_dest $_294284 s))))
(= (any_moves_to_escape $_293690) (match &self (square $_293726 $_293732 $_293690 $_293744) (match &self (square $_293780 $_293786) (if (== (clear_route ($_293726 $_293732 $_293690 $_293744) ($_293780 $_293786)) true) (let* (($_293906 (move_piece ($_293726 $_293732 $_293690 $_293744) ($_293780 $_293786))) ($_293978 (checkking $_293690)) ($_294008 (reset_pieces ($_293726 $_293732 $_293690 $_293744) ($_293780 $_293786)))) (if (== $_293978 false) (($_293726 $_293732 $_293690 $_293744) ($_293780 $_293786)) (empty))) (empty)))))
(= (any_moves_to_escape $_293078) (let $_293096 (if (== $_293078 g) s g) (match &self (square $_293180 $_293186 $_293078 $_293198) (match &self (square $_293234 $_293240 $_293096 $_293252) (if (== (clear_route ($_293180 $_293186 $_293078 $_293198) ($_293234 $_293240)) true) (let* (($_293372 (move_piece ($_293180 $_293186 $_293078 $_293198) ($_293234 $_293240))) ($_293444 (checkking $_293078)) ($_293474 (reset_pieces ($_293180 $_293186 $_293078 $_293198) ($_293234 $_293240 $_293096 $_293252)))) (if (== $_293444 false) (($_293180 $_293186 $_293078 $_293198) ($_293234 $_293240)) (empty))) (empty))))))
(= (takingboxes $_292964) (match &self (square $_293000 $_293006 $_292964 $_293018) ($_293000 $_293006 $_292964 $_293018)))
(= (takingboxes_recursive $_292514 $_292520) (if (== (size-atom $_292520) 0) () (let $_292592 (car-atom $_292520) (if (== (size-atom $_292592) 2) (let $_292676 (takingboxes_recursive $_292514 (cdr-atom $_292520)) $_292676) (let $_292736 (nth 3 $_292592) (if (== $_292736 $_292514) (let $_292676 (takingboxes_recursive $_292514 (cdr-atom $_292520)) (cons-atom $_292592 $_292676)) (let $_292676 (takingboxes_recursive $_292514 (cdr-atom $_292520)) $_292676)))))))
(= (list_clear_route $_292340 $_292346) (let* (($_292376 (superpose $_292346)) ($_292406 (clear_route $_292376 $_292340))) (if (== $_292406 true) $_292376 (empty))))
(= (list_clear_route_recursion $_291992 $_291998) (if (== (size-atom $_291998) 0) () (let* (($_292082 (car-atom $_291998)) ($_292112 (clear_route $_292082 $_291992))) (if (== $_292112 true) (let $_292190 (list_clear_route $_291992 (cdr-atom $_291998)) (cons-atom $_292082 $_292190)) (let $_292190 (list_clear_route $_291992 (cdr-atom $_291998)) $_292190)))))
(= (chess) (match &self (game-state $_288572) (if (== initializing $_288572) (progn (change-game-state started) (add-atom &self (board-state ((1 8 g r) (2 8 g n) (3 8 g b) (4 8 g q) (5 8 g k) (6 8 g b) (7 8 g n) (8 8 g r) (1 7 g p) (2 7 g p) (3 7 g p) (4 7 g p) (5 7 g p) (6 7 g p) (7 7 g p) (8 7 g p) (1 6) (2 6) (3 6) (4 6) (5 6) (6 6) (7 6) (8 6) (1 5) (2 5) (3 5) (4 5) (5 5) (6 5) (7 5) (8 5) (1 4) (2 4) (3 4) (4 4) (5 4) (6 4) (7 4) (8 4) (1 3) (2 3) (3 3) (4 3) (5 3) (6 3) (7 3) (8 3) (1 2 s p) (2 2 s p) (3 2 s p) (4 2 s p) (5 2 s p) (6 2 s p) (7 2 s p) (8 2 s p) (1 1 s r) (2 1 s n) (3 1 s b) (4 1 s q) (5 1 s k) (6 1 s b) (7 1 s n) (8 1 s r)))) (welcome)) (if (== restarted $_288572) (progn (match &self (board-state $_290306) (remove-atom &self (board-state $_290306))) (add-atom &self (board-state ((1 8 g r) (2 8 g n) (3 8 g b) (4 8 g q) (5 8 g k) (6 8 g b) (7 8 g n) (8 8 g r) (1 7 g p) (2 7 g p) (3 7 g p) (4 7 g p) (5 7 g p) (6 7 g p) (7 7 g p) (8 7 g p) (1 6) (2 6) (3 6) (4 6) (5 6) (6 6) (7 6) (8 6) (1 5) (2 5 s r) (3 5 g q) (4 5) (5 5) (6 5) (7 5) (8 5) (1 4) (2 4) (3 4) (4 4) (5 4) (6 4) (7 4) (8 4) (1 3) (2 3) (3 3) (4 3) (5 3) (6 3) (7 3) (8 3) (1 2 s p) (2 2 s p) (3 2 s p) (4 2 s p) (5 2 s p) (6 2 s p) (7 2 s p) (8 2 s p) (1 1 s r) (2 1 s n) (3 1 s b) (4 1 s q) (5 1 s k) (6 1 s b) (7 1 s n) (8 1 s r)))) (welcome)) (empty)))))
(= (M) (if (== (game-still-playing) false) (println Game over. Please reset to play again (enter r) .) (progn (let $_286832 (readln!) ()) (let $_286868 (nth 1 $_286832) ()) (let $_286916 (nth 2 $_286832) ()) (match &self (board-state $_286982) $_286982) (reset-pieces $_286982) (let $_287024 (return_entire_box $_286868) ()) (if (and (not (== $_286868 $_286916)) (== (size-atom $_287024) 4)) (progn (let $_287174 (return_entire_box $_286868) ()) (let $_287216 (if (== (size-atom $_287174) 4) (nth 3 $_287174) NIL) ()) (let $_287318 (return_entire_box $_286916) ()) (let $_287360 (if (== (size-atom $_287318) 4) (nth 3 $_287318) NIL) ()) (if (and (== $_287216 s) (or (== (size-atom $_287318) 2) (and (== (size-atom $_287318) 4) (not (== (nth 3 $_287174) $_287360))))) (if (== (clear_route $_287174 $_287318) true) (let* (($_287726 (move_piece $_287174 $_286916)) ($_287762 (checkking s))) (if (== $_287762 true) (println Can't move there, your king would be in check.) (progn (println Moving your piece...) (let $_287942 (move_piece_on_board $_287174 $_287318 $_286982) (add-atom &self (board-state $_287942))) (remove-atom &self (board-state $_286982)) (D) (let $_288074 (checkking g) (if (== $_288074 true) (let $_288146 (collapse (any_moves_to_escape g)) (if (== $_288146 ()) (progn (println Checkmate! You win!) (println Winner! Winner! Winner!) (println) (change-game-state checkmate)) (println Check! Enter g for Greedy Chess move.))) (println Enter g for Greedy Chess move.)))))) (println Can't move piece there.)) (println Invalid move.))) (println Invalid move.)) (delete-pieces))))
(= (G) (match &self (game-state $_285338) (if (or (== checkmate $_285338) (== resigned $_285338)) (println Game over. Please reset to play again (enter r) .) (progn (match &self (board-state $_285536) $_285536) (reset-pieces $_285536) (let $_285578 (decide_greedy_move) NIL) (if (== $_285578 ()) (let* (($_285662 (xy_box (g k))) ($_285704 (return_entire_box $_285662)) ($_285734 (take_dest $_285704 s))) (if (== $_285734 true) (progn (println Checkmate! You win!) (println Winner! Winner! Winner!) (println) (change-game-state checkmate)) (progn (println Greedy Chess cannot find a good move. Game over. You win!) (change-game-state resigned)))) (progn (let $_286034 (nth 1 $_285578) ()) (let $_286082 (nth 2 $_285578) ()) (let $_286130 (return_entire_box $_286082) ()) (move_piece $_286034 $_286082) (println Greedy Chess moving...) (let $_286226 (move_piece_on_board $_286034 $_286130 $_285536) (add-atom &self (board-state $_286226))) (remove-atom &self (board-state $_285536)) (D) (match &self (game-state $_286376) (if (== checkmate $_286376) (progn (println Checkmate! Greedy Chess wins!!!) (println Good game!) (println)) (let $_286514 (checkking s) (if (== $_286514 true) (println Check!) (println Your move.))))))) (progn (delete-pieces) ($_286034 $_286082 $_286226))))))
(= (R) (progn (change-game-state restarted) (chess)))
(= (C) (progn (println) (println) (println) (println) (println - Your pieces are white at bottom.) (println - Please take note of the following simple commands:) (println *------- C o m m a n d s ------------*) (println MOVE YOUR PIECE USE example -> m <ENTER> a2a3 <ENTER>) (println Result: YOUR pawn in a2 moved to location a3.) (println Greedy Chess Move (AI) -> g) (println Reset & Replay -> r) (println Commands List -> c) (println Display Board -> d) (println Quit -> q)))
(= (D) (match &self (board-state $_284582) (println $_284582)))
(= (command-loop) (progn (println Please enter your command.) (let $_284162 (readln!) (case $_284162 ((m (M)) (g (G)) (r (R)) (c (C)) (d (D)) (q (println Quitting MeTTa Greedy Chess.)) ($_284378 (println Invalid command, please try again or enter c for a list of commands.))))) (if (== $_284162 q) () (command-loop))))
(= (main_loop) (progn (chess) (command-loop)))
(highestrank k)
(highrank q)
(medrank r)
(medrank b)
(medrank n)
(lowrank p)
(rank k)
(rank q)
(rank r)
(rank b)
(rank n)
(rank p)
(game-state started)
(board-state ((1 8 g r) (2 8 g n) (3 8 g b) (4 8 g q) (5 8 g k) (6 8 g b) (7 8 g n) (8 8 g r) (1 7 g p) (2 7 g p) (3 7 g p) (4 7 g p) (5 7 g p) (6 7 g p) (7 7 g p) (8 7 g p) (1 6) (2 6) (3 6) (4 6) (5 6) (6 6) (7 6) (8 6) (1 5) (2 5) (3 5) (4 5) (5 5) (6 5) (7 5) (8 5) (1 4) (2 4) (3 4) (4 4) (5 4) (6 4) (7 4) (8 4) (1 3) (2 3) (3 3) (4 3) (5 3) (6 3) (7 3) (8 3) (1 2 s p) (2 2 s p) (3 2 s p) (4 2 s p) (5 2 s p) (6 2 s p) (7 2 s p) (8 2 s p) (1 1 s r) (2 1 s n) (3 1 s b) (4 1 s q) (5 1 s k) (6 1 s b) (7 1 s n) (8 1 s r)))
!(G)